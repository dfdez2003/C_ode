<!-- frontend/src/app/pages/lesson-editor/components/unit-concepts-exercise-form/unit-concepts-exercise-form.html -->

<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal-content">
    
    <!-- HEADER -->
    <div class="modal-header">
      <h2>{{ modalTitle }}</h2>
      <button class="close-button" (click)="onCancel()" type="button">âœ•</button>
    </div>

    <!-- FORM -->
    <form (ngSubmit)="onSubmit()" class="exercise-form">
      
      <!-- TÃ­tulo -->
      <div class="form-group">
        <label for="title">
          <span class="label-icon">ğŸ“</span>
          TÃ­tulo del Ejercicio
          <span class="required">*</span>
        </label>
        <input
          id="title"
          type="text"
          class="form-control"
          placeholder="Ej: Conceptos BÃ¡sicos de POO"
          [value]="title()"
          (input)="title.set($any($event.target).value)"
          required
          minlength="3"
        />
      </div>

      <!-- XP Recompensa -->
      <div class="form-group">
        <label for="xpReward">
          <span class="label-icon">â­</span>
          Recompensa en XP
          <span class="required">*</span>
        </label>
        <input
          id="xpReward"
          type="number"
          class="form-control"
          min="5"
          max="100"
          [value]="xpReward()"
          (input)="xpReward.set(+$any($event.target).value)"
          required
        />
        <small class="helper-text">
          Rango: 5-100 XP. Recomendado: 20-40 XP.
        </small>
      </div>

      <!-- Pares de Conceptos -->
      <div class="pairs-section">
        <div class="section-header">
          <h3>
            <span class="section-icon">ğŸ§©</span>
            Pares de Conceptos
            <span class="badge">{{ pairs().length }}</span>
          </h3>
          <button
            type="button"
            class="btn-add-pair"
            (click)="addPair()"
          >
            â• Agregar Par
          </button>
        </div>

        <div class="pairs-list">
          @for (pair of pairs(); track $index) {
            <div class="pair-item">
              
              <!-- Pair Header -->
              <div class="pair-header">
                <span class="pair-number">{{ $index + 1 }}</span>
                
                <div class="pair-actions">
                  <button
                    type="button"
                    class="btn-icon"
                    (click)="moveUp($index)"
                    [disabled]="$index === 0"
                    title="Mover arriba"
                  >
                    â†‘
                  </button>
                  
                  <button
                    type="button"
                    class="btn-icon"
                    (click)="moveDown($index)"
                    [disabled]="$index === pairs().length - 1"
                    title="Mover abajo"
                  >
                    â†“
                  </button>
                  
                  <button
                    type="button"
                    class="btn-icon btn-delete"
                    (click)="removePair($index)"
                    [disabled]="pairs().length <= 2"
                    title="Eliminar"
                  >
                    ğŸ—‘ï¸
                  </button>
                </div>
              </div>

              <!-- Concepto -->
              <div class="pair-field">
                <label class="pair-label">
                  <span class="field-icon">ğŸ”‘</span>
                  Concepto
                </label>
                <input
                  type="text"
                  class="form-control"
                  placeholder="Ej: Herencia"
                  [value]="pair.concept"
                  (input)="updateConcept($index, $any($event.target).value)"
                  required
                />
              </div>

              <!-- DefiniciÃ³n -->
              <div class="pair-field">
                <label class="pair-label">
                  <span class="field-icon">ğŸ“–</span>
                  DefiniciÃ³n
                </label>
                <textarea
                  class="form-control pair-textarea"
                  rows="2"
                  placeholder="Ej: Mecanismo que permite crear clases basadas en otras existentes"
                  [value]="pair.definition"
                  (input)="updateDefinition($index, $any($event.target).value)"
                  required
                ></textarea>
              </div>

            </div>
          }
        </div>

        <div class="helper-box">
          ğŸ’¡ <strong>Consejo:</strong> El estudiante verÃ¡ los conceptos mezclados y debe arrastrarlos para relacionarlos con las definiciones correctas.
        </div>
      </div>

      <!-- Error Message -->
      @if (error()) {
        <div class="error-box">
          <span class="error-icon">âš ï¸</span>
          {{ error() }}
        </div>
      }

      <!-- FOOTER -->
      <div class="modal-footer">
        <button
          type="button"
          class="btn-cancel"
          (click)="onCancel()"
          [disabled]="isSubmitting()"
        >
          Cancelar
        </button>
        
        <button
          type="submit"
          class="btn-submit"
          [disabled]="isSubmitting()"
        >
          @if (isSubmitting()) {
            <span class="spinner"></span>
            Guardando...
          } @else {
            @if (isEditing) {
              ğŸ’¾ Actualizar
            } @else {
              âœ¨ Crear Ejercicio
            }
          }
        </button>
      </div>

    </form>

  </div>
</div>
