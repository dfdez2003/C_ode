<!-- frontend/src/app/pages/game-map/components/lesson-form-modal/lesson-form-modal.html -->

<div class="modal-backdrop" (click)="onBackdropClick($event)">
  <div class="modal-content">
    
    <!-- Header -->
    <div class="modal-header">
      <h2>{{ modalTitle }}</h2>
      <button class="close-button" (click)="onCancel()" [disabled]="isSubmitting()">
        ‚úï
      </button>
    </div>

    <!-- Body -->
    <div class="modal-body">
      
      <!-- Error Message -->
      @if (error()) {
        <div class="error-message">
          ‚ö†Ô∏è {{ error() }}
        </div>
      }

      <!-- Form -->
      <form (ngSubmit)="onSubmit()">
        
        <!-- T√≠tulo -->
        <div class="form-group">
          <label for="lesson-title" class="form-label">
            T√≠tulo de la Lecci√≥n *
          </label>
          <input
            id="lesson-title"
            type="text"
            class="form-input"
            placeholder="Ej: Variables y Tipos de Datos"
            [(ngModel)]="title"
            [ngModelOptions]="{updateOn: 'change'}"
            name="title"
            [disabled]="isSubmitting()"
            maxlength="100"
            required
          />
          <small class="form-hint">
            M√≠nimo 3 caracteres
          </small>
        </div>

        <!-- Descripci√≥n -->
        <div class="form-group">
          <label for="lesson-description" class="form-label">
            Descripci√≥n *
          </label>
          <textarea
            id="lesson-description"
            class="form-textarea"
            placeholder="Describe el contenido de la lecci√≥n..."
            [(ngModel)]="description"
            [ngModelOptions]="{updateOn: 'change'}"
            name="description"
            [disabled]="isSubmitting()"
            rows="3"
            maxlength="500"
            required
          ></textarea>
          <small class="form-hint">
            Explica qu√© aprender√°n en esta lecci√≥n
          </small>
        </div>

        <!-- Recompensa XP -->
        <div class="form-group">
          <label for="lesson-xp" class="form-label">
            Recompensa de XP
          </label>
          <input
            id="lesson-xp"
            type="number"
            class="form-input"
            [(ngModel)]="xpReward"
            [ngModelOptions]="{updateOn: 'change'}"
            name="xpReward"
            [disabled]="isSubmitting()"
            min="10"
            max="1000"
            step="10"
            required
          />
          <small class="form-hint">
            Entre 10 y 1000 XP (por defecto: 50 XP)
          </small>
        </div>

        <!-- Lecci√≥n Privada -->
        <div class="form-group">
          <label class="checkbox-label">
            <input
              type="checkbox"
              [(ngModel)]="isPrivate"
              [ngModelOptions]="{updateOn: 'change'}"
              name="isPrivate"
              [disabled]="isSubmitting()"
            />
            <span class="checkbox-text">
              üîí Lecci√≥n Privada (estilo examen)
            </span>
          </label>
          <small class="form-hint">
            Las lecciones privadas solo se pueden hacer una vez y se bloquean al completarse
          </small>
        </div>

        <!-- Info adicional -->
        @if (!isEditing) {
          <div class="info-box">
            <p>
              ‚ÑπÔ∏è La lecci√≥n se crear√° sin ejercicios. Despu√©s de crearla, deber√°s agregar ejercicios desde Thunder Client o usando el editor de ejercicios (pr√≥ximamente).
            </p>
          </div>
        }

        @if (isEditing && lesson() && lesson()!.exercises.length === 0) {
          <div class="warning-box">
            <p>
              ‚ö†Ô∏è Esta lecci√≥n no tiene ejercicios. Los estudiantes no podr√°n completarla.
            </p>
          </div>
        }

      </form>

    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <div class="footer-left">
        @if (isEditing) {
          <button 
            type="button"
            class="btn btn-danger" 
            (click)="onDeleteLesson()"
            [disabled]="isSubmitting()">
            üóëÔ∏è Eliminar Lecci√≥n
          </button>
        }
      </div>
      <div class="footer-right">
        <button 
          type="button"
          class="btn btn-secondary" 
          (click)="onCancel()"
          [disabled]="isSubmitting()">
          Cancelar
        </button>
        <button 
          type="button"
          class="btn btn-primary" 
          (click)="onSubmit()"
          [disabled]="isSubmitting()">
          @if (isSubmitting()) {
            <span class="spinner-small"></span>
            Guardando...
          } @else {
            {{ isEditing ? 'üíæ Guardar Cambios' : '‚úÖ Crear Lecci√≥n' }}
          }
        </button>
      </div>
    </div>

  </div>
</div>
